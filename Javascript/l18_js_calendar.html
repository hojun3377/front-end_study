<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>JavaScript calendar</title>
    <link rel="stylesheet" href="./css/l18_calendar.css">
  </head>
  <body>
    <main>
      <h1>일정 등록 달력 만들기</h1>
      <!-- table#calendarTable>(thead>tr>(th{일}+th{화}+th{화}+th{수}+th{목}+th{금}+th{토}))+(tbody>(tr>td(div.date_container>h5.date+ul.schedule>li*5)*7)*6) -->
      <div class="controler-container">
        <div id="calendarControler" class="controler-content">
          <h2 class="month"></h2>
          <div class="btn-container">
            <input type="button" value="이전">
            <input type="button" value="다음">
          </div>
        </div>
      </div>
      <table id="calendarTable">
        <thead>
          <tr>
            <th>일</th>
            <th>화</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
            <th>토</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div id="scheduleModal" class="modal-container">
        <div class="modal-content">
          <h1 class="date"></h1>
          <form action="" name="modalForm">
            <div class="todo-container">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
            </div>
            <div class="btn-container">
              <input type="button" name="closeBtn" value="닫기">
              <input type="button" name="submitBtn" value="확인">
            </div>
          </form>
        </div>
      </div>
    </main>
  </body>
<script>
// ajax json
let strJSON; // ajax로 받아온 json 문자열
const scheduleJSON = {};

// calendar
const calendarControler = document.getElementById("calendarControler");
const calendarTable = document.getElementById("calendarTable");
const calendarDateEl = calendarTable.getElementsByTagName("td");
const calendarSchedule = calendarTable.getElementsByClassName("schedule");
const preMonthBtn = calendarControler.getElementsByClassName("btn-container")[0].children[0];
const postMonthBtn = calendarControler.getElementsByClassName("btn-container")[0].children[1];
const nowDateObj = new Date();

let nowYear = nowDateObj.getFullYear(),
    nowMonth = nowDateObj.getMonth();

// modal
const scheduleModal = document.getElementById("scheduleModal");
const modalDate = scheduleModal.getElementsByClassName("date")[0];
const modalForm = document.forms.modalForm;
let scheduleKey, currentScheduleEl;

const dateClick = function(e) {
  let date = this.getElementsByClassName("date")[0].innerText;

  modalDate.innerText = `${nowYear}년 ${nowMonth+1}월 ${date}일`;
  scheduleKey = `d_${nowYear}_${nowMonth+1}_${date}`;
  scheduleJSON[scheduleKey].forEach((item, i) => {
    modalForm.scheduleList[i].value = item;
  });
  currentScheduleEl = this.getElementsByClassName("schedule")[0];

  scheduleModal.style.display = "block";
};

const printCalendar = function() {
  let firstDay = new Date(nowYear,nowMonth,1).getDay(),
      lastDate = new Date(nowYear,nowMonth+1,0).getDate();

  calendarControler.children[0].innerText = `${nowYear}년 ${nowMonth+1}월`
  for(let i=0; i<firstDay; i++) {
    let preMonthDate = new Date(nowYear,nowMonth,i-firstDay+1).getDate();
    let dateEl = calendarDateEl[i].getElementsByClassName("date")[0];

    calendarDateEl[i].classList.remove("active");
    calendarDateEl[i].classList.add("disable");
    calendarDateEl[i].removeEventListener("click", dateClick);
    dateEl.innerText = preMonthDate;
  }
  for(let i=1; i<=lastDate; i++) {
    let dateEl = calendarDateEl[firstDay].getElementsByClassName("date")[0];
    let scheduleKey = `d_${nowYear}_${nowMonth+1}_${i}`;

    // ajax통신이 안되므로 대신 json을 만듬
    // 실제로는 json 객체로부터 그리기
    if(scheduleJSON[scheduleKey]===undefined) {
      scheduleJSON[scheduleKey] = ["","","","",""];
    }
    Array.from(calendarSchedule[firstDay].children).forEach((el,i) => {
      el.innerText = scheduleJSON[scheduleKey][i];
    });

    calendarDateEl[firstDay].classList.remove("disable");
    calendarDateEl[firstDay].classList.add("active");
    calendarDateEl[firstDay++].addEventListener("click", dateClick);
    dateEl.innerText=i;
  }
  for(let i=firstDay, j=1; i<calendarDateEl.length; i++,j++) {
    let dateEl = calendarDateEl[i].getElementsByClassName("date")[0];

    calendarDateEl[i].classList.remove("active");
    calendarDateEl[i].classList.add("disable");
    calendarDateEl[i].removeEventListener("click", dateClick);
    dateEl.innerText=j;
  }
};
const initModal = function() {
  modalDate.innerText = "";
  Array.from(modalForm.scheduleList).forEach(el => {
    el.value = "";
  });
  scheduleModal.style.display = "none";
}

printCalendar();
preMonthBtn.onclick = function(e) {
  nowYear += Math.floor(--nowMonth/12);
  nowMonth = nowMonth<0 ? nowMonth+12 : nowMonth%12;

  printCalendar();
}
postMonthBtn.onclick = function(e) {
  nowYear += Math.floor(++nowMonth/12);
  nowMonth %= 12;

  printCalendar();
}
modalForm.submitBtn.onclick = function(e) {
  Array.from(modalForm.scheduleList).forEach((el, i) => {
    scheduleJSON[scheduleKey][i] = el.value;
    currentScheduleEl.children[i].innerText = el.value;
  });

  // ajax 통신
  // strJSON = JSON.stringify(todoJSON);

  initModal();
};
modalForm.closeBtn.onclick = function(e) {
  initModal();
};
window.onclick = function(e) {
  if(e.target == scheduleModal) {
    initModal();
  }
}
</script>
</html>
