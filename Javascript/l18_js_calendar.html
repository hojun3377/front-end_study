<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>JavaScript calendar</title>
    <link rel="stylesheet" href="./css/l18_calendar.css">
  </head>
  <body>
    <main>
      <h1>일정 등록 달력 만들기</h1>
      <!-- table#calendarTable>(thead>tr>(th{일}+th{화}+th{화}+th{수}+th{목}+th{금}+th{토}))+(tbody>(tr>td(div.date_container>h5.date+ul.schedule>li*5)*7)*6) -->
      <div class="controler-container">
        <div id="calendarControler" class="controler-content">
          <h2 class="month"></h2>
          div.
          <div class="btn-container">
            <button type="button" value="">이전</button>
            <button type="button" value="">다음</button>
          </div>
        </div>
      </div>
      <table id="calendarTable">
        <thead>
          <tr>
            <th>일</th>
            <th>화</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
            <th>토</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
            <td>
              <div class="date_container">
                <h5 class="date"></h5>
                <ul class="schedule">
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div id="scheduleModal" class="modal-container">
        <div class="modal-content">
          <h1 class="date"></h1>
          <form action="" name="modalForm">
            <div class="todo-container">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
              <input type="text" name="scheduleList">
            </div>
            <div class="btn-container">
              <input type="button" name="closeBtn" value="닫기">
              <input type="button" name="submitBtn" value="확인">
              <input type="button" name="addBtn" value="추가">
            </div>
          </form>
        </div>
      </div>
    </main>
  </body>
<script>
// ajax json
// const strJSON; // ajax로 받아온 json 문자열
const scheduleJSON = {};

// calendar
const calendarControler = document.getElementById("calendarControler");
const calendarTable = document.getElementById("calendarTable");
const calendarDateEl = calendarTable.getElementsByTagName("td");
const calendarSchedule = calendarTable.getElementsByClassName("schedule");
const preMonthBtn = calendarControler.getElementsByClassName("btn-container")[0].children[0];
const nextMonthBtn = calendarControler.getElementsByClassName("btn-container")[0].children[1];

// modal
const scheduleModal = document.getElementById("scheduleModal");
const modalDate = scheduleModal.getElementsByClassName("date")[0];
const modalForm = document.forms.modalForm;
let scheduleKey, currentScheduleEl;

const Calendar = function(year=new Date().getFullYear(),month=new Date().getMonth(),schedule={}) {
  this.year = year;
  this.month = month;
  this.firstDay = new Date(year,month,1).getDay();
  this.lastDate = new Date(year,month+1,0).getDate();
  this.text = `${year}년 ${month+1}월`;
  this.value = year+"-"+month;
  this.preValue = `${month ? year : year-1}-${month ? month-1 : 12}`;
  this.nextValue = `${year+Math.floor(month/12)}-${month%12+1}`;
  this.schedule = schedule;

  this.setCalendar = (year,month) => {
    year = Number(year);
    month = Number(month);

    this.year = year;
    this.month = month;
    this.firstDay = new Date(year,month,1).getDay();
    this.lastDate = new Date(year,month+1,0).getDate();
    this.text = `${year}년 ${month+1}월`;
    this.value = year+"-"+month;
    this.preValue = `${month ? year : year-1}-${month ? month-1 : 12}`;
    this.nextValue = `${year+Math.floor(month/12)}-${month%12+1}`;
  }
}
const initModal = function() {
  modalDate.innerText = "";
  Array.from(modalForm.scheduleList).forEach(el => {
    el.value = "";
  });
  scheduleModal.style.display = "none";
};
const calendarPrint = function(calendar) {
  calendarControler.children[0].innerText = calendar.text;
  preMonthBtn.value = calendar.preValue;
  nextMonthBtn.value = calendar.nextValue;

  for(let i=0; i<calendar.firstDay; i++) {
    let preMonthDate = new Date(year,month,i-firstDay+1).getDate();
    let dateEl = calendarDateEl[i].getElementsByClassName("date")[0];

    calendarDateEl[i].classList.remove("active");
    calendarDateEl[i].classList.add("disable");
    calendarDateEl[i].removeEventListener("click", dateClick);
    dateEl.innerText = preMonthDate;
  }
  for(let i=1; i<=calendar.lastDate; i++) {
    let dateEl = calendarDateEl[firstDay].getElementsByClassName("date")[0];
    let scheduleKey = `d_${year}_${month+1}_${i}`;

    // ajax통신이 안되므로 대신 json을 만듬
    // 실제로는 json 객체로부터 그리기
    if(scheduleJSON[scheduleKey]===undefined) {
      scheduleJSON[scheduleKey] = ["","","","",""];
    }
    Array.from(calendarSchedule[firstDay].children).forEach((el,i) => {
      el.innerText = scheduleJSON[scheduleKey][i];
    });

    calendarDateEl[firstDay].classList.remove("disable");
    calendarDateEl[firstDay].classList.add("active");
    calendarDateEl[firstDay++].addEventListener("click", dateClick);
    dateEl.innerText=i;
  }
  for(let i=firstDay, j=1; i<calendarDateEl.length; i++,j++) {
    let dateEl = calendarDateEl[i].getElementsByClassName("date")[0];

    calendarDateEl[i].classList.remove("active");
    calendarDateEl[i].classList.add("disable");
    calendarDateEl[i].removeEventListener("click", dateClick);
    dateEl.innerText=j;
  }
};
const calendarClickEventHandler = {
  date : date => {
    // let date = this.getElementsByClassName("date")[0].innerText;
    modalDate.innerText = `${this.year}년 ${this.month+1}월 ${date}일`;
    scheduleKey = `d_${this.year}_${this.month+1}_${date}`;
    scheduleJSON[scheduleKey].forEach((item, i) => {
      modalForm.scheduleList[i].value = item;
    });
    currentScheduleEl = this.getElementsByClassName("schedule")[0];

    scheduleModal.style.display = "block";
  },
  preMonth : calendar => {
    let newYear = calendar.preValue.split("-")[0],
        newMonth = calendar.preValue.split("-")[1];
    calendar.setCalendar(newYear,newMonth);
    calendarPrint(newYear,newMonth);
  },
  nextMonth : calendar => {
    let nowYear = preMonthBtn.value.split("-")[0],
        nowMonth = preMonthBtn.value.split("-")[1];
    calendar.setCalendar(nowYear,nowMonth);
    calendarPrint(newYear,newMonth);
  },
  modalSubmit : (scheduleJSON,scheduleKey) => {
    Array.from(modalForm.scheduleList).forEach((el, i) => {
      scheduleJSON[scheduleKey][i] = el.value;
      currentScheduleEl.children[i].innerText = el.value;
    });

    // ajax 통신
    // strJSON = JSON.stringify(todoJSON);

    initModal();
  },
  modalClose : () => {
    initModal();
  }
}

const calendar = new Calendar();
calendarPrint(calendar);
// preMonthBtn.onclick = () => {
//   let newYear = calendar.preValue.split("-")[0],
//       newMonth = calendar.preValue.split("-")[1];
//   calendar.setCalendar(newYear,newMonth);
//   calendar.print();
// };
// nextMonthBtn.onclick = () => {
//   let newYear = calendar.nextValue.split("-")[0],
//       newMonth = calendar.nextValue.split("-")[1];
//   calendar.setCalendar(newYear,newMonth);
//   console.log(calendar);
//   calendar.print();
// };
// modalForm.submitBtn.onclick = function() {
//   Array.from(modalForm.scheduleList).forEach((el, i) => {
//     scheduleJSON[scheduleKey][i] = el.value;
//     currentScheduleEl.children[i].innerText = el.value;
//   });
//
//   // ajax 통신
//   // strJSON = JSON.stringify(todoJSON);
//
//   initModal();
// };
// modalForm.closeBtn.onclick = function() {
//   initModal();
// };
window.onclick = function(e) {
  if(e.target == scheduleModal) {
    initModal();
  }
}
</script>
</html>
